openapi: 3.1.1
info:
  title: Stash Auto Vision API
  description: "Complete video analysis service providing frame extraction, scene detection,\nface recognition, semantic analysis,
    and object detection capabilities.\n\nArchitecture: Microservices (6 services) coordinated via Vision API rollup endpoint.\n\
    \nServices:\n- Frame Server (port 5001) - Frame extraction and caching\n- Scenes Service (port 5002) - Scene boundary
    detection\n- Faces Service (port 5003) - Face detection, recognition, and quality assessment\n- Semantics Service (port
    5004) - SigLIP/CLIP-based scene understanding (Phase 2 implemented)\n- Objects Service (port 5005) - YOLO-World object
    detection (stub - Phase 3)\n- Jobs Viewer Service (port 5020) - Job management and monitoring UI\n- Vision API (port 5010)
    - Orchestration and rollup endpoint\n\nFor detailed service documentation, see:\n- docs/FRAME_SERVER.md\n- docs/SCENES_SERVICE.md\n\
    - docs/FACES_SERVICE.md\n- docs/SEMANTICS_SERVICE.md\n- docs/OBJECTS_SERVICE.md\n- docs/VISION_API.md\n"
  version: 1.0.0
  contact:
    name: Stash Auto Vision
    url: https://github.com/stashapp/stash-auto-vision
  license:
    name: AGPL-3.0
    url: https://www.gnu.org/licenses/agpl-3.0.html
paths:
  /vision/analyze:
    post:
      summary: Analyze Video
      description: Submit comprehensive video analysis job
      operationId: analyze_video_vision_analyze_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnalyzeVideoRequest'
        required: true
      responses:
        '202':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyzeJobResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - vision-api
  /vision/jobs/{job_id}/status:
    get:
      summary: Get Job Status
      description: "Get orchestrated job status.\n\nLooks up job across all service namespaces (vision, faces, scenes)."
      operationId: get_job_status_vision_jobs__job_id__status_get
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: string
          title: Job Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyzeJobStatus'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - vision-api
  /vision/jobs/{job_id}/results:
    get:
      summary: Get Job Results
      description: "Get orchestrated job results.\n\nLooks up job across all service namespaces (vision, faces, scenes)."
      operationId: get_job_results_vision_jobs__job_id__results_get
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: string
          title: Job Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyzeJobResults'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - vision-api
  /vision/jobs:
    get:
      summary: List Jobs
      description: "List all jobs across all services with optional filtering.\n\nAggregates jobs from vision-api, faces-service,
        and scenes-service.\nDeduplicates by cache_key, preferring vision-level jobs over service-level jobs."
      operationId: list_jobs_vision_jobs_get
      parameters:
      - name: status
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          description: Filter by status (queued, processing, completed, failed)
          title: Status
        description: Filter by status (queued, processing, completed, failed)
      - name: service
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          description: Filter by service (vision, faces, scenes)
          title: Service
        description: Filter by service (vision, faces, scenes)
      - name: source_id
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          description: Filter by source_id
          title: Source Id
        description: Filter by source_id
      - name: source
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          description: Filter by source video path
          title: Source
        description: Filter by source video path
      - name: start_date
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          description: Filter by start date (ISO format, e.g., 2025-01-01T00:00:00Z)
          title: Start Date
        description: Filter by start date (ISO format, e.g., 2025-01-01T00:00:00Z)
      - name: end_date
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          description: Filter by end date (ISO format)
          title: End Date
        description: Filter by end date (ISO format)
      - name: include_results
        in: query
        required: false
        schema:
          type: boolean
          description: Include full job results in response
          default: false
          title: Include Results
        description: Include full job results in response
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 500
          minimum: 1
          description: Maximum number of jobs to return
          default: 50
          title: Limit
        description: Maximum number of jobs to return
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          minimum: 0
          description: Number of jobs to skip
          default: 0
          title: Offset
        description: Number of jobs to skip
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListJobsResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - vision-api
  /vision/jobs/count:
    get:
      summary: Count Jobs
      description: "Count jobs matching filters without fetching full results.\n\nThis endpoint provides efficient counting
        for pagination and tab displays.\nIt uses the same filtering logic as /vision/jobs but only counts jobs\nwithout fetching
        full metadata or results.\n\nReturns:\n    {\n        \"total\": 147,\n        \"by_service\": {\n            \"vision\"\
        : 23,\n            \"faces\": 47,\n            \"scenes\": 45,\n            \"semantics\": 32,\n            \"objects\"\
        : 0\n        }\n    }"
      operationId: count_jobs_vision_jobs_count_get
      parameters:
      - name: status
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          description: Filter by job status (queued, processing, completed, failed)
          title: Status
        description: Filter by job status (queued, processing, completed, failed)
      - name: service
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          description: Filter by service (vision, faces, scenes, semantics, objects)
          title: Service
        description: Filter by service (vision, faces, scenes, semantics, objects)
      - name: source_id
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          description: Filter by source_id (scene identifier)
          title: Source Id
        description: Filter by source_id (scene identifier)
      - name: source
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          description: Filter by source video path
          title: Source
        description: Filter by source video path
      - name: start_date
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          description: Filter by start date (ISO 8601 format)
          title: Start Date
        description: Filter by start date (ISO 8601 format)
      - name: end_date
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          description: Filter by end date (ISO 8601 format)
          title: End Date
        description: Filter by end date (ISO 8601 format)
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                type: object
                title: Response Count Jobs Vision Jobs Count Get
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - vision-api
  /vision/health:
    get:
      summary: Health Check
      description: Health check for orchestrator and all services
      operationId: health_check_vision_health_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
      tags:
      - vision-api
      - health
  /frames/extract:
    post:
      summary: Extract Frames
      description: "Submit frame extraction job\n\nArgs:\n    request: Extraction request parameters\n    background_tasks:
        FastAPI background task manager\n\nReturns:\n    Job submission response with job_id and status"
      operationId: extract_frames_frames_extract_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExtractFramesRequest'
        required: true
      responses:
        '202':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExtractJobResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - frames
  /frames/jobs/{job_id}/status:
    get:
      summary: Get Job Status
      description: "Get job status and progress\n\nArgs:\n    job_id: Job identifier\n\nReturns:\n    Job status information"
      operationId: get_job_status_frames_jobs__job_id__status_get
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: string
          title: Job Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExtractJobStatus'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - frames
  /frames/jobs/{job_id}/results:
    get:
      summary: Get Job Results
      description: "Get job results (only available when status=completed)\n\nArgs:\n    job_id: Job identifier\n\nReturns:\n\
        \    Complete job results with frames and metadata"
      operationId: get_job_results_frames_jobs__job_id__results_get
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: string
          title: Job Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExtractJobResults'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - frames
  /frames/extract-frame:
    get:
      summary: Extract Single Frame
      description: "Extract a single frame from video at specific timestamp\n\nLightweight endpoint for one-off frame extraction
        without job tracking.\nUseful for thumbnails, previews, and poster frames.\n\nUses automatic fallback across extraction
        methods (OpenCV → PyAV → FFmpeg)\nfor robust handling of corrupted or poorly-encoded videos.\n\nArgs:\n    video_path:
        Absolute path to video file\n    timestamp: Timestamp in seconds\n    output_format: jpeg or png\n    quality: JPEG
        quality (1-100)\n    enhance: Enable face enhancement (0 = disabled, 1 = enabled)\n    fidelity_weight: Enhancement
        fidelity (0.0-1.0, lower = preserve original)\n\nReturns:\n    FileResponse with extracted frame"
      operationId: extract_single_frame_frames_extract_frame_get
      parameters:
      - name: video_path
        in: query
        required: true
        schema:
          type: string
          title: Video Path
      - name: timestamp
        in: query
        required: true
        schema:
          type: number
          title: Timestamp
      - name: output_format
        in: query
        required: false
        schema:
          type: string
          default: jpeg
          title: Output Format
      - name: quality
        in: query
        required: false
        schema:
          type: integer
          default: 95
          title: Quality
      - name: enhance
        in: query
        required: false
        schema:
          type: integer
          default: 0
          title: Enhance
      - name: model
        in: query
        required: false
        schema:
          type: string
          default: codeformer
          title: Model
      - name: fidelity_weight
        in: query
        required: false
        schema:
          type: number
          default: 0.7
          title: Fidelity Weight
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - frames
  /frames/{job_id}/{frame_index}:
    get:
      summary: Get Frame
      description: "Get a specific frame from an extraction job\n\nServes frames on-demand with polling support. If extraction
        is in progress,\ncan optionally wait for the frame to become available.\n\nArgs:\n    job_id: Job identifier\n   \
        \ frame_index: Frame index to retrieve\n    wait: If True, wait up to 30s for frame to be extracted\n\nReturns:\n\
        \    FileResponse with frame image"
      operationId: get_frame_frames__job_id___frame_index__get
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: string
          title: Job Id
      - name: frame_index
        in: path
        required: true
        schema:
          type: integer
          title: Frame Index
      - name: wait
        in: query
        required: false
        schema:
          type: boolean
          default: true
          title: Wait
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - frames
  /frames/health:
    get:
      summary: Health Check
      description: "Service health check\n\nReturns:\n    Health status and service information"
      operationId: health_check_frames_health_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
      tags:
      - frames
      - health
  /scenes/detect:
    post:
      summary: Detect Scenes
      description: "Submit scene detection job\n\nArgs:\n    request: Detection request parameters\n    background_tasks:
        FastAPI background task manager\n\nReturns:\n    Job submission response with job_id and status"
      operationId: detect_scenes_scenes_detect_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DetectScenesRequest'
        required: true
      responses:
        '202':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DetectJobResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - scenes
  /scenes/jobs/{job_id}/status:
    get:
      summary: Get Job Status
      description: "Get job status and progress\n\nArgs:\n    job_id: Job identifier\n\nReturns:\n    Job status information"
      operationId: get_job_status_scenes_jobs__job_id__status_get
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: string
          title: Job Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DetectJobStatus'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - scenes
  /scenes/jobs/{job_id}/results:
    get:
      summary: Get Job Results
      description: "Get job results (only available when status=completed)\n\nArgs:\n    job_id: Job identifier\n\nReturns:\n\
        \    Complete job results with scene boundaries and metadata"
      operationId: get_job_results_scenes_jobs__job_id__results_get
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: string
          title: Job Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DetectJobResults'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - scenes
  /scenes/health:
    get:
      summary: Health Check
      description: "Service health check\n\nReturns:\n    Health status and service information"
      operationId: health_check_scenes_health_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
      tags:
      - scenes
      - health
  /faces/analyze:
    post:
      summary: Analyze Faces
      description: Submit face analysis job
      operationId: analyze_faces_faces_analyze_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnalyzeFacesRequest'
        required: true
      responses:
        '202':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyzeJobResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - faces
  /faces/jobs/{job_id}/status:
    get:
      summary: Get Job Status
      description: Get job status
      operationId: get_job_status_faces_jobs__job_id__status_get
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: string
          title: Job Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyzeJobStatus'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - faces
  /faces/jobs/{job_id}/results:
    get:
      summary: Get Job Results
      description: Get job results
      operationId: get_job_results_faces_jobs__job_id__results_get
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: string
          title: Job Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyzeJobResults'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - faces
  /faces/health:
    get:
      summary: Health Check
      description: Service health check
      operationId: health_check_faces_health_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
      tags:
      - faces
      - health
  /semantics/analyze:
    post:
      summary: Analyze Semantics
      description: Submit semantics analysis job
      operationId: analyze_semantics_semantics_analyze_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnalyzeSemanticsRequest'
        required: true
      responses:
        '202':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyzeSemanticsResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - semantics
  /semantics/jobs/{job_id}/status:
    get:
      summary: Get Job Status
      description: Get job status
      operationId: get_job_status_semantics_jobs__job_id__status_get
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: string
          title: Job Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobStatusResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - semantics
  /semantics/jobs/{job_id}/results:
    get:
      summary: Get Job Results
      description: Get job results
      operationId: get_job_results_semantics_jobs__job_id__results_get
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: string
          title: Job Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SemanticsResults'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - semantics
  /semantics/health:
    get:
      summary: Health Check
      description: Health check endpoint
      operationId: health_check_semantics_health_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
      tags:
      - semantics
      - health
  /objects/analyze:
    post:
      summary: Analyze Objects
      description: "Stub endpoint for object analysis\n\nPhase 3 implementation will use YOLO-World for:\n- Open-vocabulary
        object detection\n- Custom object categories\n- Temporal object tracking\n- Bounding box annotations"
      operationId: analyze_objects_objects_analyze_post
      requestBody:
        content:
          application/json:
            schema:
              type: object
              title: Request
        required: true
      responses:
        '202':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - objects
  /objects/jobs/{job_id}/status:
    get:
      summary: Get Job Status
      description: Stub endpoint for job status
      operationId: get_job_status_objects_jobs__job_id__status_get
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: string
          title: Job Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - objects
  /objects/jobs/{job_id}/results:
    get:
      summary: Get Job Results
      description: Stub endpoint for job results
      operationId: get_job_results_objects_jobs__job_id__results_get
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: string
          title: Job Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
      tags:
      - objects
  /objects/health:
    get:
      summary: Health Check
      description: Health check endpoint
      operationId: health_check_objects_health_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
      tags:
      - objects
      - health
  /viewer/health:
    get:
      summary: Health check
      operationId: getHealth
      tags:
      - jobs-viewer
      - health
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
  /openapi.json:
    get:
      summary: OpenAPI schema
      operationId: getOpenApiSchema
      tags:
      - jobs-viewer
      responses:
        '200':
          description: OpenAPI 3.0 schema
          content:
            application/json: {}
  /api/proxy:
    get:
      summary: CORS proxy for external URLs
      operationId: proxyUrl
      tags:
      - jobs-viewer
      parameters:
      - name: url
        in: query
        required: true
        schema:
          type: string
          format: uri
        description: External URL to proxy (http/https)
      responses:
        '200':
          description: Proxied content with CORS headers
        '400':
          description: Invalid or missing URL parameter
        '500':
          description: Failed to fetch external URL
  /api/vision/jobs:
    get:
      summary: List jobs with filters
      operationId: listJobs
      tags:
      - jobs-viewer
      parameters:
      - name: status
        in: query
        schema:
          $ref: '#/components/schemas/JobStatus'
      - name: service
        in: query
        schema:
          $ref: '#/components/schemas/ServiceName'
      - name: source_id
        in: query
        schema:
          type: string
      - name: source
        in: query
        schema:
          type: string
      - name: start_date
        in: query
        schema:
          type: string
          format: date-time
      - name: end_date
        in: query
        schema:
          type: string
          format: date-time
      - name: include_results
        in: query
        schema:
          type: boolean
      - name: limit
        in: query
        schema:
          type: integer
          default: 20
      - name: offset
        in: query
        schema:
          type: integer
          default: 0
      responses:
        '200':
          description: List of jobs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListJobsResponse'
  /api/vision/jobs/count:
    get:
      summary: Count jobs by service
      operationId: countJobs
      tags:
      - jobs-viewer
      parameters:
      - name: status
        in: query
        schema:
          $ref: '#/components/schemas/JobStatus'
      - name: service
        in: query
        schema:
          $ref: '#/components/schemas/ServiceName'
      - name: source_id
        in: query
        schema:
          type: string
      - name: start_date
        in: query
        schema:
          type: string
          format: date-time
      - name: end_date
        in: query
        schema:
          type: string
          format: date-time
      responses:
        '200':
          description: Job counts by service
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobCountResponse'
  /api/vision/jobs/{job_id}/status:
    get:
      summary: Get job status
      operationId: getJobStatus
      tags:
      - jobs-viewer
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Job status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobStatusResponse'
        '404':
          description: Job not found
  /api/vision/jobs/{job_id}/results:
    get:
      summary: Get job results
      operationId: getJobResults
      tags:
      - jobs-viewer
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Job results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobResults'
        '404':
          description: Job not found
  /api/frames/extract-frame:
    get:
      summary: Extract frame from video
      operationId: extractFrame
      tags:
      - jobs-viewer
      parameters:
      - name: video_path
        in: query
        required: true
        schema:
          type: string
        description: Path to video file
      - name: timestamp
        in: query
        required: true
        schema:
          type: number
        description: Timestamp in seconds
      - name: output_format
        in: query
        schema:
          type: string
          enum:
          - jpeg
          - png
          default: jpeg
      - name: quality
        in: query
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 95
      - name: enhance
        in: query
        schema:
          type: boolean
          default: false
        description: Apply face enhancement
      responses:
        '200':
          description: Frame image
          content:
            image/jpeg: {}
            image/png: {}
        '400':
          description: Invalid parameters
        '404':
          description: Video not found
components:
  schemas:
    AnalyzeJobResponse:
      properties:
        job_id:
          type: string
          title: Job Id
        status:
          $ref: '#/components/schemas/JobStatus'
        created_at:
          type: string
          title: Created At
      type: object
      required:
      - job_id
      - status
      - created_at
      title: AnalyzeJobResponse
      description: Response for face analysis job submission
    AnalyzeJobResults:
      properties:
        job_id:
          type: string
          title: Job Id
        source_id:
          type: string
          title: Source Id
        status:
          $ref: '#/components/schemas/JobStatus'
        faces:
          items:
            $ref: '#/components/schemas/Face'
          type: array
          title: Faces
        metadata:
          $ref: '#/components/schemas/VideoMetadata'
      type: object
      required:
      - job_id
      - source_id
      - status
      - faces
      - metadata
      title: AnalyzeJobResults
      description: Complete job results
    AnalyzeJobStatus:
      properties:
        job_id:
          type: string
          title: Job Id
        status:
          $ref: '#/components/schemas/JobStatus'
        progress:
          type: number
          maximum: 1.0
          minimum: 0.0
          title: Progress
        stage:
          anyOf:
          - type: string
          - type: 'null'
          title: Stage
        message:
          anyOf:
          - type: string
          - type: 'null'
          title: Message
        created_at:
          type: string
          title: Created At
        started_at:
          anyOf:
          - type: string
          - type: 'null'
          title: Started At
        completed_at:
          anyOf:
          - type: string
          - type: 'null'
          title: Completed At
        result_summary:
          anyOf:
          - type: object
          - type: 'null'
          title: Result Summary
        error:
          anyOf:
          - type: string
          - type: 'null'
          title: Error
      type: object
      required:
      - job_id
      - status
      - progress
      - created_at
      title: AnalyzeJobStatus
      description: Job status response
    AnalyzeVideoRequest:
      properties:
        source:
          type: string
          title: Source
          description: Path, URL, or image source to analyze
        source_id:
          type: string
          title: Source Id
          description: Scene ID for reference
        job_id:
          anyOf:
          - type: string
          - type: 'null'
          title: Job Id
          description: Job ID for tracking
        processing_mode:
          type: string
          title: Processing Mode
          description: sequential or parallel
          default: sequential
        modules:
          $ref: '#/components/schemas/ModulesConfig'
      type: object
      required:
      - source
      - source_id
      title: AnalyzeVideoRequest
      description: Request to analyze video with all services
    HTTPValidationError:
      properties:
        detail:
          items:
            $ref: '#/components/schemas/ValidationError'
          type: array
          title: Detail
      type: object
      title: HTTPValidationError
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          example: healthy
        service:
          type: string
          example: jobs-viewer
        timestamp:
          type: string
          format: date-time
        uptime:
          type: number
          description: Uptime in seconds
      required:
      - status
      - service
      - timestamp
      - uptime
    JobSummary:
      type: object
      properties:
        job_id:
          type: string
        service:
          $ref: '#/components/schemas/ServiceName'
        status:
          $ref: '#/components/schemas/JobStatus'
        progress:
          type: number
          minimum: 0
          maximum: 1
        source:
          type: string
        source_id:
          type: string
        created_at:
          type: string
          format: date-time
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
        result_summary:
          type: object
      required:
      - job_id
      - service
      - status
      - progress
    ListJobsResponse:
      type: object
      properties:
        jobs:
          type: array
          items:
            $ref: '#/components/schemas/JobSummary'
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer
      required:
      - jobs
      - total
      - limit
      - offset
    ModuleConfig:
      properties:
        enabled:
          type: boolean
          title: Enabled
          default: true
        parameters:
          type: object
          title: Parameters
      type: object
      title: ModuleConfig
      description: Configuration for a single module
    ModulesConfig:
      properties:
        scenes:
          $ref: '#/components/schemas/ModuleConfig'
        faces:
          $ref: '#/components/schemas/ModuleConfig'
        semantics:
          $ref: '#/components/schemas/ModuleConfig'
        objects:
          $ref: '#/components/schemas/ModuleConfig'
      type: object
      title: ModulesConfig
      description: Module configurations
    ServiceJobInfo:
      type: object
      properties:
        service:
          type: string
        job_id:
          type: string
        status:
          type: string
        progress:
          type: number
        message:
          type: string
        error:
          type: string
      required:
      - service
      - status
      - progress
    ValidationError:
      properties:
        loc:
          items:
            anyOf:
            - type: string
            - type: integer
          type: array
          title: Location
        msg:
          type: string
          title: Message
        type:
          type: string
          title: Error Type
      type: object
      required:
      - loc
      - msg
      - type
      title: ValidationError
    EnhancementModel:
      type: string
      enum:
      - gfpgan
      - codeformer
      title: EnhancementModel
      description: Face enhancement models
    EnhancementOptions:
      properties:
        enabled:
          type: boolean
          title: Enabled
          description: Enable face enhancement
          default: false
        model:
          allOf:
          - $ref: '#/components/schemas/EnhancementModel'
          description: Enhancement model to use
          default: gfpgan
        fidelity_weight:
          type: number
          maximum: 1.0
          minimum: 0.0
          title: Fidelity Weight
          description: Balance between quality and fidelity (0=preserve original, 1=max enhancement)
          default: 0.7
        upscale:
          type: integer
          maximum: 4.0
          minimum: 1.0
          title: Upscale
          description: Upscaling factor
          default: 2
        only_center_face:
          type: boolean
          title: Only Center Face
          description: Only enhance the most centered face
          default: false
        paste_back:
          type: boolean
          title: Paste Back
          description: Paste enhanced faces back to original image
          default: true
      type: object
      title: EnhancementOptions
      description: Face enhancement configuration
    ExtractFramesRequest:
      properties:
        video_path:
          type: string
          title: Video Path
          description: Absolute path to video file
        job_id:
          anyOf:
          - type: string
          - type: 'null'
          title: Job Id
          description: Parent job ID for tracking
        extraction_method:
          allOf:
          - $ref: '#/components/schemas/ExtractionMethod'
          default: opencv_cuda
        sampling_strategy:
          $ref: '#/components/schemas/SamplingStrategy'
        use_sprites:
          type: boolean
          title: Use Sprites
          description: Use sprite sheets if available
          default: false
        sprite_vtt_url:
          anyOf:
          - type: string
          - type: 'null'
          title: Sprite Vtt Url
        sprite_image_url:
          anyOf:
          - type: string
          - type: 'null'
          title: Sprite Image Url
        scene_boundaries:
          anyOf:
          - items:
              additionalProperties:
                type: number
              type: object
            type: array
          - type: 'null'
          title: Scene Boundaries
          description: Scene boundaries from scenes-service
        output_format:
          allOf:
          - $ref: '#/components/schemas/OutputFormat'
          default: jpeg
        quality:
          type: integer
          maximum: 100.0
          minimum: 1.0
          title: Quality
          description: JPEG quality
          default: 95
        enhancement:
          allOf:
          - $ref: '#/components/schemas/EnhancementOptions'
          description: Face enhancement options
        cache_duration:
          type: integer
          minimum: 0.0
          title: Cache Duration
          description: Cache TTL in seconds
          default: 3600
      type: object
      required:
      - video_path
      title: ExtractFramesRequest
      description: Request to extract frames from video
    ExtractJobResponse:
      properties:
        job_id:
          type: string
          title: Job Id
        status:
          $ref: '#/components/schemas/JobStatus'
        created_at:
          type: string
          title: Created At
        cache_key:
          type: string
          title: Cache Key
        estimated_frames:
          anyOf:
          - type: integer
          - type: 'null'
          title: Estimated Frames
      type: object
      required:
      - job_id
      - status
      - created_at
      - cache_key
      title: ExtractJobResponse
      description: Response for frame extraction job submission
    ExtractJobResults:
      properties:
        job_id:
          type: string
          title: Job Id
        status:
          $ref: '#/components/schemas/JobStatus'
        cache_key:
          type: string
          title: Cache Key
        frames:
          items:
            $ref: '#/components/schemas/FrameMetadata'
          type: array
          title: Frames
        metadata:
          $ref: '#/components/schemas/VideoMetadata'
      type: object
      required:
      - job_id
      - status
      - cache_key
      - frames
      - metadata
      title: ExtractJobResults
      description: Complete job results
    ExtractJobStatus:
      properties:
        job_id:
          type: string
          title: Job Id
        status:
          $ref: '#/components/schemas/JobStatus'
        progress:
          type: number
          maximum: 1.0
          minimum: 0.0
          title: Progress
        stage:
          anyOf:
          - type: string
          - type: 'null'
          title: Stage
        message:
          anyOf:
          - type: string
          - type: 'null'
          title: Message
        frames_extracted:
          anyOf:
          - type: integer
          - type: 'null'
          title: Frames Extracted
        frames_total:
          anyOf:
          - type: integer
          - type: 'null'
          title: Frames Total
        created_at:
          type: string
          title: Created At
        started_at:
          anyOf:
          - type: string
          - type: 'null'
          title: Started At
        completed_at:
          anyOf:
          - type: string
          - type: 'null'
          title: Completed At
        error:
          anyOf:
          - type: string
          - type: 'null'
          title: Error
      type: object
      required:
      - job_id
      - status
      - progress
      - created_at
      title: ExtractJobStatus
      description: Job status response
    ExtractionMethod:
      type: string
      enum:
      - opencv_cuda
      - opencv_cpu
      - ffmpeg
      - sprites
      title: ExtractionMethod
      description: Frame extraction methods
    FrameMetadata:
      properties:
        index:
          type: integer
          title: Index
        timestamp:
          type: number
          title: Timestamp
        url:
          type: string
          title: Url
        width:
          type: integer
          title: Width
        height:
          type: integer
          title: Height
      type: object
      required:
      - index
      - timestamp
      - url
      - width
      - height
      title: FrameMetadata
      description: Metadata for a single extracted frame
    JobStatus:
      type: string
      enum:
      - queued
      - processing
      - completed
      - failed
    OutputFormat:
      type: string
      enum:
      - jpeg
      - png
      title: OutputFormat
      description: Output image format
    SamplingMode:
      type: string
      enum:
      - interval
      - timestamps
      - scene_based
      title: SamplingMode
      description: Frame sampling strategies
    SamplingStrategy:
      properties:
        mode:
          allOf:
          - $ref: '#/components/schemas/SamplingMode'
          default: interval
        interval_seconds:
          anyOf:
          - type: number
            maximum: 10.0
            minimum: 0.1
          - type: 'null'
          title: Interval Seconds
          default: 2.0
        timestamps:
          anyOf:
          - items:
              type: number
            type: array
          - type: 'null'
          title: Timestamps
      type: object
      title: SamplingStrategy
      description: Frame sampling configuration
    VideoMetadata:
      properties:
        source:
          type: string
          title: Source
        source_type:
          anyOf:
          - type: string
          - type: 'null'
          title: Source Type
          description: "Source type: 'video', 'image', or 'url'"
        total_frames:
          type: integer
          title: Total Frames
        frames_processed:
          type: integer
          title: Frames Processed
        unique_faces:
          type: integer
          title: Unique Faces
        total_detections:
          type: integer
          title: Total Detections
        processing_time_seconds:
          type: number
          title: Processing Time Seconds
        method:
          type: string
          title: Method
        model:
          type: string
          title: Model
        frame_enhancement:
          anyOf:
          - $ref: '#/components/schemas/EnhancementParameters'
          - type: 'null'
          description: Frame enhancement settings used (if enhancement was enabled)
      type: object
      required:
      - source
      - total_frames
      - frames_processed
      - unique_faces
      - total_detections
      - processing_time_seconds
      - method
      - model
      title: VideoMetadata
      description: Video file metadata
    DetectJobResponse:
      properties:
        job_id:
          type: string
          title: Job Id
        source_id:
          type: string
          title: Source Id
        status:
          $ref: '#/components/schemas/JobStatus'
        created_at:
          type: string
          title: Created At
        cache_key:
          type: string
          title: Cache Key
        estimated_scenes:
          anyOf:
          - type: integer
          - type: 'null'
          title: Estimated Scenes
      type: object
      required:
      - job_id
      - source_id
      - status
      - created_at
      - cache_key
      title: DetectJobResponse
      description: Response for scene detection job submission
    DetectJobResults:
      properties:
        job_id:
          type: string
          title: Job Id
        source_id:
          type: string
          title: Source Id
        status:
          $ref: '#/components/schemas/JobStatus'
        cache_key:
          type: string
          title: Cache Key
        scenes:
          items:
            $ref: '#/components/schemas/SceneBoundary'
          type: array
          title: Scenes
        metadata:
          $ref: '#/components/schemas/VideoMetadata'
      type: object
      required:
      - job_id
      - source_id
      - status
      - cache_key
      - scenes
      - metadata
      title: DetectJobResults
      description: Complete job results
    DetectJobStatus:
      properties:
        job_id:
          type: string
          title: Job Id
        source_id:
          type: string
          title: Source Id
        status:
          $ref: '#/components/schemas/JobStatus'
        progress:
          type: number
          maximum: 1.0
          minimum: 0.0
          title: Progress
        stage:
          anyOf:
          - type: string
          - type: 'null'
          title: Stage
        message:
          anyOf:
          - type: string
          - type: 'null'
          title: Message
        scenes_detected:
          anyOf:
          - type: integer
          - type: 'null'
          title: Scenes Detected
        created_at:
          type: string
          title: Created At
        started_at:
          anyOf:
          - type: string
          - type: 'null'
          title: Started At
        completed_at:
          anyOf:
          - type: string
          - type: 'null'
          title: Completed At
        error:
          anyOf:
          - type: string
          - type: 'null'
          title: Error
      type: object
      required:
      - job_id
      - source_id
      - status
      - progress
      - created_at
      title: DetectJobStatus
      description: Job status response
    DetectScenesRequest:
      properties:
        video_path:
          type: string
          title: Video Path
          description: Absolute path to video file
        source_id:
          anyOf:
          - type: string
          - type: 'null'
          title: Source Id
          description: Optional source identifier
          default: N/A
        job_id:
          anyOf:
          - type: string
          - type: 'null'
          title: Job Id
          description: Parent job ID for tracking
        detection_method:
          allOf:
          - $ref: '#/components/schemas/DetectionMethod'
          default: content
        scene_threshold:
          type: number
          maximum: 100.0
          minimum: 0.0
          title: Scene Threshold
          description: Detection threshold
          default: 27.0
        min_scene_length:
          type: number
          minimum: 0.1
          title: Min Scene Length
          description: Minimum scene length in seconds
          default: 0.6
        cache_duration:
          type: integer
          minimum: 0.0
          title: Cache Duration
          description: Cache TTL in seconds
          default: 31536000
      type: object
      required:
      - video_path
      title: DetectScenesRequest
      description: Request to detect scene boundaries in video
    DetectionMethod:
      type: string
      enum:
      - content
      - threshold
      - adaptive
      title: DetectionMethod
      description: Scene detection methods
    SceneBoundary:
      properties:
        scene_number:
          type: integer
          title: Scene Number
        start_frame:
          type: integer
          title: Start Frame
        end_frame:
          type: integer
          title: End Frame
        start_timestamp:
          type: number
          title: Start Timestamp
        end_timestamp:
          type: number
          title: End Timestamp
        duration:
          type: number
          title: Duration
      type: object
      required:
      - scene_number
      - start_frame
      - end_frame
      - start_timestamp
      - end_timestamp
      - duration
      title: SceneBoundary
      description: Scene boundary information
    AnalyzeFacesRequest:
      properties:
        source:
          type: string
          title: Source
          description: Path, URL, or image source to analyze
        source_type:
          anyOf:
          - type: string
          - type: 'null'
          title: Source Type
          description: "Source type: 'video', 'image', 'url' (auto-detected if omitted)"
        original_source:
          anyOf:
          - type: string
          - type: 'null'
          title: Original Source
          description: Original source path/URL before download (for metadata)
        source_id:
          type: string
          title: Source Id
          description: Scene ID for reference
        job_id:
          anyOf:
          - type: string
          - type: 'null'
          title: Job Id
          description: Parent job ID for tracking
        parameters:
          $ref: '#/components/schemas/FaceAnalysisParameters'
      type: object
      required:
      - source
      - source_id
      title: AnalyzeFacesRequest
      description: Request to analyze faces in video/image
    BoundingBox:
      type: object
      properties:
        x_min:
          type: number
        y_min:
          type: number
        x_max:
          type: number
        y_max:
          type: number
      required:
      - x_min
      - y_min
      - x_max
      - y_max
    Demographics:
      type: object
      properties:
        age:
          type: integer
        gender:
          type: string
          enum:
          - M
          - F
        emotion:
          type: string
    Detection:
      type: object
      properties:
        frame_index:
          type: integer
        timestamp:
          type: number
        bbox:
          $ref: '#/components/schemas/BoundingBox'
        confidence:
          type: number
        quality:
          $ref: '#/components/schemas/Quality'
        pose:
          type: string
        landmarks:
          $ref: '#/components/schemas/Landmarks'
        enhanced:
          type: boolean
        occlusion:
          $ref: '#/components/schemas/Occlusion'
    EnhancementParameters:
      properties:
        enabled:
          type: boolean
          title: Enabled
          description: Enable face enhancement
          default: false
        quality_trigger:
          type: number
          maximum: 1.0
          minimum: 0.0
          title: Quality Trigger
          description: Trigger enhancement if quality below this
          default: 0.5
        model:
          type: string
          title: Model
          description: "Enhancement model: 'gfpgan' or 'codeformer'"
          default: codeformer
        fidelity_weight:
          type: number
          maximum: 1.0
          minimum: 0.0
          title: Fidelity Weight
          description: Fidelity vs quality tradeoff
          default: 0.5
      type: object
      title: EnhancementParameters
      description: Face enhancement configuration
    Face:
      type: object
      properties:
        face_id:
          type: string
        embedding:
          type: array
          items:
            type: number
        demographics:
          $ref: '#/components/schemas/Demographics'
        detections:
          type: array
          items:
            $ref: '#/components/schemas/Detection'
        representative_detection:
          $ref: '#/components/schemas/Detection'
    FaceAnalysisParameters:
      properties:
        face_min_confidence:
          type: number
          maximum: 1.0
          minimum: 0.0
          title: Face Min Confidence
          default: 0.7
        face_min_quality:
          type: number
          maximum: 1.0
          minimum: 0.0
          title: Face Min Quality
          description: Minimum quality threshold (filter below this)
          default: 0.2
        max_faces:
          type: integer
          maximum: 1000.0
          minimum: 1.0
          title: Max Faces
          default: 50
        sampling_interval:
          type: number
          maximum: 10.0
          minimum: 0.1
          title: Sampling Interval
          description: Sampling interval in seconds (auto-adjusted for short videos)
          default: 2.0
        use_sprites:
          type: boolean
          title: Use Sprites
          default: false
        sprite_vtt_url:
          anyOf:
          - type: string
          - type: 'null'
          title: Sprite Vtt Url
        sprite_image_url:
          anyOf:
          - type: string
          - type: 'null'
          title: Sprite Image Url
        enable_deduplication:
          type: boolean
          title: Enable Deduplication
          default: true
        embedding_similarity_threshold:
          type: number
          maximum: 1.0
          minimum: 0.0
          title: Embedding Similarity Threshold
          default: 0.6
        detect_demographics:
          type: boolean
          title: Detect Demographics
          default: true
        scene_boundaries:
          anyOf:
          - items:
              additionalProperties:
                type: number
              type: object
            type: array
          - type: 'null'
          title: Scene Boundaries
        cache_duration:
          type: integer
          minimum: 0.0
          title: Cache Duration
          default: 31536000
        enhancement:
          $ref: '#/components/schemas/EnhancementParameters'
      type: object
      title: FaceAnalysisParameters
      description: Face analysis configuration
    Landmarks:
      type: object
      properties:
        left_eye:
          type: array
          items:
            type: number
          minItems: 2
          maxItems: 2
        right_eye:
          type: array
          items:
            type: number
          minItems: 2
          maxItems: 2
        nose:
          type: array
          items:
            type: number
          minItems: 2
          maxItems: 2
        mouth_left:
          type: array
          items:
            type: number
          minItems: 2
          maxItems: 2
        mouth_right:
          type: array
          items:
            type: number
          minItems: 2
          maxItems: 2
    Occlusion:
      type: object
      properties:
        occluded:
          type: boolean
        probability:
          type: number
    Quality:
      type: object
      properties:
        composite:
          type: number
        components:
          $ref: '#/components/schemas/QualityComponents'
    QualityComponents:
      type: object
      properties:
        size:
          type: number
        pose:
          type: number
        occlusion:
          type: number
        sharpness:
          type: number
    AnalyzeSemanticsRequest:
      properties:
        source:
          type: string
          title: Source
          description: Video path or URL
        source_id:
          type: string
          title: Source Id
          description: Scene identifier for reference
        job_id:
          anyOf:
          - type: string
          - type: 'null'
          title: Job Id
          description: Parent job ID for tracking
        frame_extraction_job_id:
          anyOf:
          - type: string
          - type: 'null'
          title: Frame Extraction Job Id
          description: Job ID from Frame Server (reuse extracted frames)
        scenes_job_id:
          anyOf:
          - type: string
          - type: 'null'
          title: Scenes Job Id
          description: Job ID from Scenes Service (fetch pre-computed scene boundaries)
        parameters:
          $ref: '#/components/schemas/SemanticsParameters'
      type: object
      required:
      - source
      - source_id
      title: AnalyzeSemanticsRequest
      description: Request to analyze scene semantics
    AnalyzeSemanticsResponse:
      properties:
        job_id:
          type: string
          title: Job Id
        status:
          $ref: '#/components/schemas/JobStatus'
        message:
          anyOf:
          - type: string
          - type: 'null'
          title: Message
        created_at:
          type: string
          title: Created At
        cache_hit:
          type: boolean
          title: Cache Hit
          description: Whether results were retrieved from cache
          default: false
      type: object
      required:
      - job_id
      - status
      - created_at
      title: AnalyzeSemanticsResponse
      description: Response for semantics analysis job submission
    FrameSemantics:
      type: object
      properties:
        frame_index:
          type: integer
        timestamp:
          type: number
        tags:
          type: array
          items:
            $ref: '#/components/schemas/SemanticTag'
        embedding:
          type: array
          items:
            type: number
        scene_classification:
          $ref: '#/components/schemas/SceneClassification'
    JobStatusResponse:
      type: object
      properties:
        job_id:
          type: string
        status:
          $ref: '#/components/schemas/JobStatus'
        progress:
          type: number
          minimum: 0
          maximum: 1
        processing_mode:
          type: string
        stage:
          type: string
        message:
          type: string
        services:
          type: array
          items:
            $ref: '#/components/schemas/ServiceJobInfo'
        created_at:
          type: string
          format: date-time
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
        result_summary:
          type: object
        error:
          type: string
      required:
      - job_id
      - status
      - progress
      - processing_mode
      - services
      - created_at
    SceneClassification:
      type: object
      properties:
        setting:
          type: string
        location:
          type: string
        activity:
          type: string
    SceneSemanticSummary:
      type: object
      properties:
        start_timestamp:
          type: number
        end_timestamp:
          type: number
        dominant_tags:
          type: array
          items:
            type: string
        frame_count:
          type: integer
        avg_confidence:
          type: number
    SceneSemanticsOutcome:
      properties:
        frames:
          items:
            $ref: '#/components/schemas/FrameSemantics'
          type: array
          title: Frames
        scene_summaries:
          anyOf:
          - items:
              $ref: '#/components/schemas/SceneSemanticSummary'
            type: array
          - type: 'null'
          title: Scene Summaries
        metadata:
          $ref: '#/components/schemas/SemanticsMetadata'
      type: object
      required:
      - frames
      - metadata
      title: SceneSemanticsOutcome
      description: Semantic analysis results for a scene
    SemanticTag:
      type: object
      properties:
        tag:
          type: string
        confidence:
          type: number
        source:
          type: string
          enum:
          - predefined
          - custom_prompt
          - zero_shot
      required:
      - tag
      - confidence
      - source
    SemanticsMetadata:
      type: object
      properties:
        source:
          type: string
        source_type:
          type: string
        total_frames:
          type: integer
        model:
          type: string
        frames_analyzed:
          type: integer
        processing_time_seconds:
          type: number
        device:
          type: string
        batch_size:
          type: integer
        total_tags_generated:
          type: integer
    SemanticsParameters:
      properties:
        model:
          type: string
          title: Model
          description: CLIP/SigLIP model variant
          default: google/siglip-base-patch16-224
        classification_tags:
          anyOf:
          - items:
              type: string
            type: array
          - type: 'null'
          title: Classification Tags
          description: Predefined tags for zero-shot classification
        custom_prompts:
          anyOf:
          - items:
              type: string
            type: array
          - type: 'null'
          title: Custom Prompts
          description: Custom text prompts for zero-shot classification
        generate_embeddings:
          type: boolean
          title: Generate Embeddings
          description: Generate multi-modal embeddings for similarity search
          default: true
        min_confidence:
          type: number
          maximum: 1.0
          minimum: 0.0
          title: Min Confidence
          description: Minimum confidence threshold for tag assignment
          default: 0.5
        top_k_tags:
          type: integer
          maximum: 20.0
          minimum: 1.0
          title: Top K Tags
          description: Maximum number of tags to return per frame
          default: 5
        batch_size:
          type: integer
          maximum: 128.0
          minimum: 1.0
          title: Batch Size
          description: Batch size for inference
          default: 32
        sampling_interval:
          type: number
          maximum: 10.0
          minimum: 0.1
          title: Sampling Interval
          description: Frame sampling interval in seconds
          default: 2.0
        scene_boundaries:
          anyOf:
          - items:
              additionalProperties:
                type: number
              type: object
            type: array
          - type: 'null'
          title: Scene Boundaries
          description: Scene boundaries from scenes-service (start_timestamp, end_timestamp)
      type: object
      title: SemanticsParameters
      description: Semantics analysis configuration
    SemanticsResults:
      properties:
        job_id:
          type: string
          title: Job Id
        source_id:
          type: string
          title: Source Id
        status:
          $ref: '#/components/schemas/JobStatus'
        semantics:
          $ref: '#/components/schemas/SceneSemanticsOutcome'
        metadata:
          $ref: '#/components/schemas/SemanticsMetadata'
      type: object
      required:
      - job_id
      - source_id
      - status
      - semantics
      - metadata
      title: SemanticsResults
      description: Complete semantics analysis results
    ServiceName:
      type: string
      enum:
      - vision
      - faces
      - scenes
      - semantics
      - objects
    JobCountResponse:
      type: object
      properties:
        total:
          type: integer
        by_service:
          type: object
          properties:
            vision:
              type: integer
            faces:
              type: integer
            scenes:
              type: integer
            semantics:
              type: integer
            objects:
              type: integer
      required:
      - total
      - by_service
    JobResults:
      type: object
      properties:
        job_id:
          type: string
        source_id:
          type: string
        status:
          type: string
        scenes:
          $ref: '#/components/schemas/ScenesResult'
        faces:
          $ref: '#/components/schemas/FacesResult'
        semantics:
          $ref: '#/components/schemas/SemanticsResult'
        objects:
          type: object
        metadata:
          $ref: '#/components/schemas/JobMetadata'
      required:
      - job_id
      - source_id
      - status
      - metadata
    JobMetadata:
      type: object
      properties:
        processing_time_seconds:
          type: number
        processing_mode:
          type: string
        services_used:
          type: object
    ScenesResult:
      type: object
      properties:
        job_id:
          type: string
        source_id:
          type: string
        status:
          type: string
        scenes:
          type: array
          items:
            $ref: '#/components/schemas/Scene'
        metadata:
          $ref: '#/components/schemas/ScenesMetadata'
    Scene:
      type: object
      properties:
        scene_number:
          type: integer
        start_time:
          type: number
        end_time:
          type: number
        start_timestamp:
          type: number
        end_timestamp:
          type: number
        start_frame:
          type: integer
        end_frame:
          type: integer
        duration:
          type: number
    ScenesMetadata:
      type: object
      properties:
        video_path:
          type: string
        total_duration_seconds:
          type: number
        video_duration_seconds:
          type: number
        total_scenes:
          type: integer
        processing_time_seconds:
          type: number
        detector:
          type: string
        detection_method:
          type: string
        threshold:
          type: number
        total_frames:
          type: integer
        video_fps:
          type: number
    FacesResult:
      type: object
      properties:
        job_id:
          type: string
        source_id:
          type: string
        status:
          type: string
        faces:
          type: array
          items:
            $ref: '#/components/schemas/Face'
        metadata:
          $ref: '#/components/schemas/FacesMetadata'
    FacesMetadata:
      type: object
      properties:
        source:
          type: string
        total_frames:
          type: integer
        frames_processed:
          type: integer
        unique_faces:
          type: integer
        total_detections:
          type: integer
        processing_time_seconds:
          type: number
        method:
          type: string
        model:
          type: string
    SemanticsResult:
      type: object
      properties:
        job_id:
          type: string
        source_id:
          type: string
        status:
          type: string
        frames:
          type: array
          items:
            $ref: '#/components/schemas/FrameSemantics'
        scene_summaries:
          type: array
          items:
            $ref: '#/components/schemas/SceneSemanticSummary'
        metadata:
          $ref: '#/components/schemas/SemanticsMetadata'
  securitySchemes: {}
security: []
tags:
- name: vision-api
  description: Orchestration and multi-module analysis
  externalDocs:
    description: Learn more about Vision API
    url: https://github.com/smegmarip/stash-auto-vision/blob/main/docs/VISION_API.md
- name: health
  description: Service health checks
- name: frames
  description: Frame extraction and serving
  externalDocs:
    description: Learn more about Frame Service
    url: https://github.com/smegmarip/stash-auto-vision/blob/main/docs/FRAME_SERVER.md
- name: scenes
  description: Scene boundary detection
  externalDocs:
    description: Learn more about Scenes Service
    url: https://github.com/smegmarip/stash-auto-vision/blob/main/docs/SCENES_SERVICE.md
- name: faces
  description: Face detection, recognition, and quality assessment
  externalDocs:
    description: Learn more about Faces Service
    url: https://github.com/smegmarip/stash-auto-vision/blob/main/docs/FACES_SERVICE.md
- name: semantics
  description: Semantic scene understanding with SigLIP/CLIP
  externalDocs:
    description: Learn more about Semantics Service
    url: https://github.com/smegmarip/stash-auto-vision/blob/main/docs/SEMANTICS_SERVICE.md
- name: objects
  description: Object detection and classification
  externalDocs:
    description: Learn more about Objects Service
    url: https://github.com/smegmarip/stash-auto-vision/blob/main/docs/OBJECTS_SERVICE.md
- name: jobs-viewer
  description: Job management and monitoring
servers:
- url: http://localhost:5010
  description: Vision API (Rollup/Orchestrator)
- url: http://localhost:5001
  description: Frame Server Service
- url: http://localhost:5002
  description: Scenes Service
- url: http://localhost:5003
  description: Faces Service
- url: http://localhost:5004
  description: Semantics Service
- url: http://localhost:5005
  description: Objects Service
- url: http://localhost:5020
  description: Jobs Viewer Service
